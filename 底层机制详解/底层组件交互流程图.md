# Controller-Runtime åº•å±‚ç»„ä»¶äº¤äº’æµç¨‹å›¾

## 1. å®Œæ•´ç»„ä»¶æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Kubernetes API Server                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /apis/myservice.cyk.io/v1/apiservices                        â”‚  â”‚
â”‚  â”‚  - List() å…¨é‡è·å–                                             â”‚  â”‚
â”‚  â”‚  - Watch() å¢é‡ç›‘å¬                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Controller-Runtime Manager                      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cache (Informer é›†åˆ)                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Informer for Apiservice                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  SharedIndexInformer                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Reflector                                  â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - ListerWatcher (List/Watch)              â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Store (DeltaFIFO)                       â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - ResyncPeriod                            â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  DeltaFIFO                                 â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - queue: []string                        â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - items: map[string]Deltas                â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - knownObjects: Indexer                   â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Indexer (ThreadSafeStore)                â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - cacheStorage: map[string]interface{}    â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - indices: map[string]Index              â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Processor (sharedProcessor)              â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - listeners: []processorListener          â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Controller (Informer Controller)          â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - ä» DeltaFIFO å¼¹å‡ºäº‹ä»¶                    â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - æ›´æ–° Indexer                            â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - åˆ†å‘åˆ° Processor                        â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Controller for Apiservice                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Source (èµ„æºç›‘å¬æº)                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Kind: &myservicev1.Apiservice{}                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  EventHandler                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - EnqueueRequestForObject                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - OnAdd/OnUpdate/OnDelete                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Workqueue                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - queue: []interface{}                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - dirty: set                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - processing: set                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - rateLimiter                                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Worker (goroutine)                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ä» Workqueue è·å–è¯·æ±‚                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - è°ƒç”¨ Reconcile()                                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Client (å°è£…)                                               â”‚  â”‚
â”‚  â”‚  - Reader: Cache (ä¼˜å…ˆä½¿ç”¨ Indexer)                          â”‚  â”‚
â”‚  â”‚  - Writer: Direct API Server                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½ çš„æ§åˆ¶å™¨ä»£ç                                     â”‚
â”‚                                                                     â”‚
â”‚  ApiserviceReconciler {                                            â”‚
â”‚    Client: mgr.GetClient()  â† ä½¿ç”¨ Cache ä½œä¸º Reader                â”‚
â”‚    Scheme: mgr.GetScheme()                                         â”‚
â”‚                                                                     â”‚
â”‚    Reconcile(ctx, req) {                                           â”‚
â”‚      r.Get(ctx, req.NamespacedName, obj)  â† ä» Indexer è·å–       â”‚
â”‚      // ä¸šåŠ¡é€»è¾‘                                                    â”‚
â”‚      return ctrl.Result{}, nil                                     â”‚
â”‚    }                                                                â”‚
â”‚  }                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. åˆå§‹åŒ–æµç¨‹æ—¶åºå›¾

```
main() å‡½æ•°
    â”‚
    â”œâ”€â†’ ctrl.NewManager()
    â”‚       â”‚
    â”‚       â”œâ”€â†’ åˆ›å»º Cache
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â†’ ä¸ºæ¯ä¸ª GVK åˆ›å»º Informer
    â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”œâ”€â†’ åˆ›å»º SharedIndexInformer
    â”‚       â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â†’ åˆ›å»º Reflector
    â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â†’ è®¾ç½® ListerWatcher
    â”‚       â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â†’ åˆ›å»º DeltaFIFO
    â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â†’ è®¾ç½® knownObjects (Indexer)
    â”‚       â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â†’ åˆ›å»º Indexer
    â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â†’ ThreadSafeStore
    â”‚       â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â†’ åˆ›å»º Processor
    â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â†’ sharedProcessor
    â”‚       â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â”‚       â”‚       â””â”€â†’ åˆ›å»º Controller (Informer Controller)
    â”‚       â”‚       â”‚       â”‚           â””â”€â†’ è¿æ¥ DeltaFIFO å’Œ Processor
    â”‚       â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â†’ è¿”å› Cache
    â”‚       â”‚
    â”‚       â”œâ”€â†’ åˆ›å»º Client
    â”‚       â”‚       â””â”€â†’ ä½¿ç”¨ Cache ä½œä¸º Reader
    â”‚       â”‚
    â”‚       â””â”€â†’ è¿”å› Manager
    â”‚
    â”œâ”€â†’ SetupWithManager(mgr)
    â”‚       â”‚
    â”‚       â”œâ”€â†’ ctrl.NewControllerManagedBy(mgr)
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â†’ For(&myservicev1.Apiservice{})
    â”‚       â”‚       â”‚       â””â”€â†’ åˆ›å»º Source
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â†’ åˆ›å»º EventHandler
    â”‚       â”‚       â”‚       â””â”€â†’ EnqueueRequestForObject
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â†’ åˆ›å»º Workqueue
    â”‚       â”‚       â”‚       â””â”€â†’ NewNamedRateLimitingQueue()
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â†’ Complete(r)
    â”‚       â”‚               â”‚
    â”‚       â”‚               â”œâ”€â†’ åˆ›å»º Controller
    â”‚       â”‚               â”‚       â””â”€â†’ è¿æ¥ Source, EventHandler, Workqueue
    â”‚       â”‚               â”‚
    â”‚       â”‚               â””â”€â†’ æ³¨å†Œ EventHandler åˆ° Informer
    â”‚       â”‚                       â””â”€â†’ informer.AddEventHandler(handler)
    â”‚       â”‚                           â””â”€â†’ æ·»åŠ åˆ° Processor.listeners
    â”‚       â”‚
    â”‚       â””â”€â†’ è¿”å› Controller
    â”‚
    â””â”€â†’ mgr.Start()
            â”‚
            â”œâ”€â†’ å¯åŠ¨ Cache
            â”‚       â”‚
            â”‚       â””â”€â†’ å¯åŠ¨æ‰€æœ‰ Informer
            â”‚               â”‚
            â”‚               â”œâ”€â†’ å¯åŠ¨ Reflector
            â”‚               â”‚       â”‚
            â”‚               â”‚       â”œâ”€â†’ æ‰§è¡Œ List() (å…¨é‡åŒæ­¥)
            â”‚               â”‚       â”‚       â”‚
            â”‚               â”‚       â”‚       â”œâ”€â†’ è·å–æ‰€æœ‰èµ„æº
            â”‚               â”‚       â”‚       â”‚
            â”‚               â”‚       â”‚       â””â”€â†’ æ·»åŠ åˆ° DeltaFIFO
            â”‚               â”‚       â”‚               â””â”€â†’ ç±»å‹: Sync
            â”‚               â”‚       â”‚
            â”‚               â”‚       â””â”€â†’ å¯åŠ¨ Watch() (å¢é‡ç›‘å¬)
            â”‚               â”‚               â”‚
            â”‚               â”‚               â””â”€â†’ æŒç»­ç›‘å¬ API Server
            â”‚               â”‚
            â”‚               â””â”€â†’ å¯åŠ¨ Controller (Informer Controller)
            â”‚                       â”‚
            â”‚                       â””â”€â†’ å¯åŠ¨ goroutine å¤„ç† DeltaFIFO
            â”‚
            â””â”€â†’ å¯åŠ¨æ‰€æœ‰ Controller
                    â”‚
                    â””â”€â†’ å¯åŠ¨ Worker goroutine
                            â”‚
                            â””â”€â†’ ä» Workqueue è·å–è¯·æ±‚å¹¶å¤„ç†
```

---

## 3. è¿è¡Œæ—¶äº‹ä»¶å¤„ç†æµç¨‹

### 3.1 èµ„æºåˆ›å»ºäº‹ä»¶

```
æ—¶é—´çº¿:
T0: ç”¨æˆ·åœ¨ Kubernetes ä¸­åˆ›å»º Apiservice CR
    â”‚
    â””â”€â†’ kubectl apply -f apiservice.yaml
            â”‚
            â””â”€â†’ API Server åˆ›å»ºèµ„æº

T1: API Server å‘é€ Watch äº‹ä»¶
    â”‚
    â””â”€â†’ Watch Event: {Type: ADDED, Object: <Apiservice>}
            â”‚
            â””â”€â†’ HTTP å“åº”å‘é€åˆ° Reflector

T2: Reflector æ¥æ”¶äº‹ä»¶
    â”‚
    â””â”€â†’ reflector.watchHandler()
            â”‚
            â”œâ”€â†’ è§£æäº‹ä»¶ç±»å‹ (ADDED)
            â”‚
            â””â”€â†’ è°ƒç”¨ DeltaFIFO.queueActionLocked()
                    â”‚
                    â”œâ”€â†’ æ·±æ‹·è´å¯¹è±¡
                    â”‚   â””â”€â†’ obj.DeepCopyObject()
                    â”‚
                    â”œâ”€â†’ åˆ›å»º Delta
                    â”‚   â””â”€â†’ Delta{Type: Add, Object: <æ·±æ‹·è´çš„å¯¹è±¡>}
                    â”‚
                    â””â”€â†’ æ·»åŠ åˆ° DeltaFIFO
                            â”‚
                            â”œâ”€â†’ items["default/my-api"] = [Delta{Add, ...}]
                            â”‚
                            â””â”€â†’ queue = ["default/my-api"]

T3: Informer Controller å¤„ç† Delta
    â”‚
    â””â”€â†’ controller.processLoop()
            â”‚
            â”œâ”€â†’ ä» DeltaFIFO å¼¹å‡º
            â”‚   â””â”€â†’ DeltaFIFO.Pop()
            â”‚       â””â”€â†’ è¿”å› Delta{Type: Add, Object: <å¯¹è±¡>}
            â”‚
            â”œâ”€â†’ æ›´æ–° Indexer
            â”‚   â””â”€â†’ Indexer.Add(obj)
            â”‚       â””â”€â†’ cacheStorage["default/my-api"] = <å¯¹è±¡å¼•ç”¨>
            â”‚
            â””â”€â†’ åˆ†å‘åˆ° Processor
                    â”‚
                    â””â”€â†’ Processor.distribute()
                            â”‚
                            â””â”€â†’ è°ƒç”¨æ‰€æœ‰ listener
                                    â”‚
                                    â””â”€â†’ listener.handler.OnAdd(obj)

T4: EventHandler å¤„ç†äº‹ä»¶
    â”‚
    â””â”€â†’ EnqueueRequestForObject.OnAdd(obj)
            â”‚
            â”œâ”€â†’ æå– NamespacedName
            â”‚   â””â”€â†’ {Namespace: "default", Name: "my-api"}
            â”‚
            â””â”€â†’ åˆ›å»º Request
                    â”‚
                    â””â”€â†’ Request{NamespacedName: {...}}
                            â”‚
                            â””â”€â†’ Workqueue.Add(req)

T5: Workqueue æ¥æ”¶è¯·æ±‚
    â”‚
    â””â”€â†’ Workqueue.Add(req)
            â”‚
            â”œâ”€â†’ æ·»åŠ åˆ° queue
            â”‚   â””â”€â†’ queue = [Request{...}]
            â”‚
            â””â”€â†’ æ ‡è®°ä¸º dirty
                â””â”€â†’ dirty.add(req)

T6: Controller Worker å¤„ç†è¯·æ±‚
    â”‚
    â””â”€â†’ Worker goroutine
            â”‚
            â”œâ”€â†’ ä» Workqueue è·å–
            â”‚   â””â”€â†’ Workqueue.Get()
            â”‚       â””â”€â†’ è¿”å› Request{...}
            â”‚
            â”œâ”€â†’ åˆ›å»º Context
            â”‚   â””â”€â†’ context.WithTimeout(...)
            â”‚
            â””â”€â†’ è°ƒç”¨ Reconcile
                    â”‚
                    â””â”€â†’ Reconcile(ctx, req)
                            â”‚
                            â”œâ”€â†’ ä» Indexer è·å–å¯¹è±¡
                            â”‚   â””â”€â†’ r.Get(ctx, req.NamespacedName, obj)
                            â”‚       â””â”€â†’ Indexer.GetByKey("default/my-api")
                            â”‚           â””â”€â†’ è¿”å›ç¼“å­˜çš„å¯¹è±¡
                            â”‚
                            â”œâ”€â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                            â”‚   â””â”€â†’ åˆ›å»º Deployment, Service ç­‰
                            â”‚
                            â””â”€â†’ è¿”å›ç»“æœ
                                    â”‚
                                    â””â”€â†’ return ctrl.Result{}, nil

T7: å¤„ç†å®Œæˆ
    â”‚
    â””â”€â†’ Workqueue.Done(req)
            â”‚
            â””â”€â†’ ä» processing ä¸­ç§»é™¤
```

### 3.2 èµ„æºæ›´æ–°äº‹ä»¶

```
API Server: Watch Event {Type: MODIFIED, Object: <æ›´æ–°çš„å¯¹è±¡>}
    â†“
Reflector: æ¥æ”¶äº‹ä»¶
    â†“
DeltaFIFO: queueActionLocked(Update, obj)
    â”œâ”€â†’ æ·±æ‹·è´å¯¹è±¡
    â””â”€â†’ æ·»åŠ åˆ°é˜Ÿåˆ—: Delta{Type: Update, Object: <æ·±æ‹·è´>}
    â†“
Informer Controller: å¤„ç† Delta
    â”œâ”€â†’ æ›´æ–° Indexer
    â”‚   â””â”€â†’ Indexer.Update(obj)  â† æ›¿æ¢ç¼“å­˜ä¸­çš„å¯¹è±¡
    â””â”€â†’ åˆ†å‘åˆ° Processor
        â†“
EventHandler: OnUpdate(oldObj, newObj)
    â””â”€â†’ åˆ›å»º Request â†’ æ·»åŠ åˆ° Workqueue
        â†“
Controller Worker: å¤„ç†è¯·æ±‚
    â””â”€â†’ Reconcile(ctx, req)
        â””â”€â†’ r.Get() è·å–æœ€æ–°å¯¹è±¡ (ä» Indexer)
            â””â”€â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
```

### 3.3 èµ„æºåˆ é™¤äº‹ä»¶

```
API Server: Watch Event {Type: DELETED, Object: <åˆ é™¤çš„å¯¹è±¡>}
    â†“
Reflector: æ¥æ”¶äº‹ä»¶
    â†“
DeltaFIFO: queueActionLocked(Delete, obj)
    â”œâ”€â†’ æ·±æ‹·è´å¯¹è±¡
    â””â”€â†’ æ·»åŠ åˆ°é˜Ÿåˆ—: Delta{Type: Delete, Object: <æ·±æ‹·è´>}
    â†“
Informer Controller: å¤„ç† Delta
    â”œâ”€â†’ ä» Indexer åˆ é™¤
    â”‚   â””â”€â†’ Indexer.Delete(obj)
    â””â”€â†’ åˆ†å‘åˆ° Processor
        â†“
EventHandler: OnDelete(obj)
    â””â”€â†’ åˆ›å»º Request â†’ æ·»åŠ åˆ° Workqueue
        â†“
Controller Worker: å¤„ç†è¯·æ±‚
    â””â”€â†’ Reconcile(ctx, req)
        â””â”€â†’ r.Get() è¿”å› NotFound é”™è¯¯
            â””â”€â†’ å¤„ç†åˆ é™¤é€»è¾‘ (æ¸…ç†èµ„æº)
```

---

## 4. æ•°æ®æ‹·è´æµç¨‹

### 4.1 æ·±æ‹·è´æ—¶æœº

```
API Server å¯¹è±¡
    â”‚ (HTTP å“åº”ï¼ŒJSON ååºåˆ—åŒ–)
    â†“
Reflector æ¥æ”¶
    â”‚ (å¯¹è±¡å¼•ç”¨)
    â†“
DeltaFIFO.queueActionLocked()
    â”‚
    â”œâ”€â†’ obj.DeepCopyObject()  â† ğŸ”´ ç¬¬ä¸€æ¬¡æ·±æ‹·è´
    â”‚
    â””â”€â†’ åˆ›å»º Delta{Type: Add, Object: <æ·±æ‹·è´çš„å¯¹è±¡>}
        â”‚
        â””â”€â†’ å­˜å‚¨åˆ° DeltaFIFO.items
            â”‚
            â””â”€â†’ DeltaFIFO.Pop() æ—¶è¿”å›
                â”‚ (æ·±æ‹·è´çš„å¯¹è±¡)
                â†“
            Indexer.Add(obj)
                â”‚ (å­˜å‚¨å¯¹è±¡å¼•ç”¨ï¼Œä¸æ·±æ‹·è´)
                â†“
            Processor.distribute()
                â”‚ (ä¼ é€’å¯¹è±¡å¼•ç”¨)
                â†“
            EventHandler.OnAdd(obj)
                â”‚ (å¯¹è±¡å¼•ç”¨)
                â†“
            åˆ›å»º Request (å€¼ç±»å‹ï¼Œè‡ªåŠ¨æ‹·è´)
                â”‚
                â””â”€â†’ Request{NamespacedName: {...}}
                    â”‚ (å€¼ç±»å‹)
                    â†“
                Workqueue.Add(req)
                    â”‚ (å€¼ç±»å‹ï¼Œè‡ªåŠ¨æ‹·è´)
                    â†“
                Controller Worker
                    â”‚
                    â””â”€â†’ Reconcile(ctx, req)
                        â”‚ (req æ˜¯å€¼ç±»å‹)
                        â†“
                    r.Get(ctx, req.NamespacedName, obj)
                        â”‚
                        â”œâ”€â†’ ä» Indexer è·å– (å¯¹è±¡å¼•ç”¨)
                        â”‚
                        â””â”€â†’ å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œåº”è¯¥æ·±æ‹·è´
                            â””â”€â†’ obj.DeepCopyObject()  â† ğŸ”´ ç¬¬äºŒæ¬¡æ·±æ‹·è´ (å¯é€‰)
```

### 4.2 æ‹·è´ä½ç½®æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·±æ‹·è´ä½ç½®:                                              â”‚
â”‚                                                         â”‚
â”‚  1. DeltaFIFO.queueActionLocked()                      â”‚
â”‚     â””â”€â†’ obj.DeepCopyObject()  â† å¿…é¡»æ·±æ‹·è´               â”‚
â”‚                                                         â”‚
â”‚  2. Reconcile ä¸­ä¿®æ”¹å¯¹è±¡å‰ (å¯é€‰)                        â”‚
â”‚     â””â”€â†’ obj.DeepCopyObject()  â† å¦‚æœéœ€è¦ä¿®æ”¹å¯¹è±¡         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ…æ‹·è´/å¼•ç”¨ä½ç½®:                                         â”‚
â”‚                                                         â”‚
â”‚  1. Indexer å­˜å‚¨                                         â”‚
â”‚     â””â”€â†’ å­˜å‚¨å¯¹è±¡å¼•ç”¨                                      â”‚
â”‚                                                         â”‚
â”‚  2. Processor åˆ†å‘                                      â”‚
â”‚     â””â”€â†’ ä¼ é€’å¯¹è±¡å¼•ç”¨                                      â”‚
â”‚                                                         â”‚
â”‚  3. EventHandler æ¥æ”¶                                    â”‚
â”‚     â””â”€â†’ æ¥æ”¶å¯¹è±¡å¼•ç”¨                                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å€¼ç±»å‹ (è‡ªåŠ¨æ‹·è´):                                       â”‚
â”‚                                                         â”‚
â”‚  1. Request (ctrl.Request)                              â”‚
â”‚     â””â”€â†’ å€¼ç±»å‹ï¼Œè‡ªåŠ¨æ‹·è´                                  â”‚
â”‚                                                         â”‚
â”‚  2. NamespacedName                                      â”‚
â”‚     â””â”€â†’ å€¼ç±»å‹ï¼Œè‡ªåŠ¨æ‹·è´                                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯åŠ¨é˜¶æ®µ (mgr.Start())                                   â”‚
â”‚                                                         â”‚
â”‚  T0: åˆ›å»ºæ‰€æœ‰ç»„ä»¶                                        â”‚
â”‚  T1: å¯åŠ¨ Informer                                       â”‚
â”‚      â”œâ”€â†’ å¯åŠ¨ Reflector                                  â”‚
â”‚      â”‚   â””â”€â†’ æ‰§è¡Œ List() (å…¨é‡åŒæ­¥)                       â”‚
â”‚      â”‚       â””â”€â†’ å¡«å…… Indexer                            â”‚
â”‚      â””â”€â†’ å¯åŠ¨ Watch() (å¢é‡ç›‘å¬)                         â”‚
â”‚  T2: å¯åŠ¨ Controller Worker                              â”‚
â”‚      â””â”€â†’ å¼€å§‹å¤„ç† Workqueue                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œé˜¶æ®µ (æŒç»­è¿è¡Œ)                                       â”‚
â”‚                                                         â”‚
â”‚  - Reflector æŒç»­ç›‘å¬ API Server                         â”‚
â”‚  - DeltaFIFO æŒç»­æ¥æ”¶äº‹ä»¶                                 â”‚
â”‚  - Informer Controller æŒç»­å¤„ç† DeltaFIFO                â”‚
â”‚  - Indexer æŒç»­æ›´æ–°ç¼“å­˜                                   â”‚
â”‚  - Processor æŒç»­åˆ†å‘äº‹ä»¶                                â”‚
â”‚  - EventHandler æŒç»­å¤„ç†äº‹ä»¶                              â”‚
â”‚  - Workqueue æŒç»­æ¥æ”¶è¯·æ±‚                                 â”‚
â”‚  - Controller Worker æŒç»­å¤„ç†è¯·æ±‚                         â”‚
â”‚  - Reconcile æŒç»­åè°ƒèµ„æº                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœæ­¢é˜¶æ®µ (æ”¶åˆ°åœæ­¢ä¿¡å·)                                   â”‚
â”‚                                                         â”‚
â”‚  T0: æ”¶åˆ°åœæ­¢ä¿¡å· (Ctrl+C æˆ– Pod ç»ˆæ­¢)                    â”‚
â”‚  T1: åœæ­¢ Reflector (åœæ­¢ Watch)                         â”‚
â”‚  T2: åœæ­¢ Informer Controller                            â”‚
â”‚  T3: åœæ­¢ Controller Worker                              â”‚
â”‚  T4: å…³é—­ Workqueue                                      â”‚
â”‚  T5: æ¸…ç†èµ„æº                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å…³é”®ä»£ç ä½ç½®é€ŸæŸ¥

### 6.1 Controller-Runtime

| ç»„ä»¶ | ä»£ç ä½ç½® |
|------|---------|
| Manager | `sigs.k8s.io/controller-runtime/pkg/manager/manager.go` |
| Cache | `sigs.k8s.io/controller-runtime/pkg/cache/cache.go` |
| Controller | `sigs.k8s.io/controller-runtime/pkg/controller/controller.go` |
| Source | `sigs.k8s.io/controller-runtime/pkg/source/source.go` |
| Handler | `sigs.k8s.io/controller-runtime/pkg/handler/handler.go` |

### 6.2 Client-Go

| ç»„ä»¶ | ä»£ç ä½ç½® |
|------|---------|
| Informer | `k8s.io/client-go/tools/cache/shared_informer.go` |
| Reflector | `k8s.io/client-go/tools/cache/reflector.go` |
| DeltaFIFO | `k8s.io/client-go/tools/cache/delta_fifo.go` |
| Indexer | `k8s.io/client-go/tools/cache/store.go` |
| Workqueue | `k8s.io/client-go/util/workqueue/queue.go` |

---

## 7. æ€»ç»“

è¿™äº›åº•å±‚ç»„ä»¶è™½ç„¶è¢« Controller-Runtime å°è£…äº†ï¼Œä½†å®ƒä»¬ä»ç„¶åœ¨åå°å·¥ä½œï¼š

1. **Reflector**: ç›‘å¬ API Serverï¼Œæ¥æ”¶èµ„æºå˜æ›´
2. **DeltaFIFO**: å­˜å‚¨å˜æ›´äº‹ä»¶ï¼Œä¿è¯é¡ºåº
3. **Indexer**: æœ¬åœ°ç¼“å­˜ï¼Œå¿«é€ŸæŸ¥è¯¢
4. **Processor**: åˆ†å‘äº‹ä»¶åˆ° EventHandler
5. **Workqueue**: ç®¡ç† Reconcile è¯·æ±‚é˜Ÿåˆ—
6. **Controller Worker**: å¤„ç† Reconcile è¯·æ±‚

ç†è§£è¿™äº›ç»„ä»¶çš„å·¥ä½œåŸç†ï¼Œæœ‰åŠ©äºï¼š
- è°ƒè¯•é—®é¢˜
- æ€§èƒ½ä¼˜åŒ–
- æ·±å…¥ç†è§£ Kubernetes Operator
